name: Upload to OSS
on:
  # Runs on pushes targeting the default branch
  push:
    branches: ["main"]

jobs:
  upload-to-oss:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Set up Python
      uses: actions/setup-python@v2
      with:
        python-version: '3.x'
    - uses: actions/setup-node@v2
      with:
        node-version: 18
        registry-url: https://registry.npmjs.org/
    - name: Install And Build
      run: npm i && npm run build
    - name: Install Aliyun CLI
      run: |
        curl -O https://aliyuncli.alicdn.com/aliyun-cli-linux-latest-amd64.tgz
        tar -xzf aliyun-cli-linux-latest-amd64.tgz
        chmod +x aliyun
        ./aliyun version
    - name: Sync to OSS
      run: ./aliyun oss cp ./dist oss://${{ secrets.OSS_BUCKET }}/ --meta Cache-Control:"max-age=3600" -r -f -e oss-cn-hangzhou.aliyuncs.com --access-key-id ${{ secrets.ALIYUN_ACCESS_KEY_ID }} --access-key-secret ${{ secrets.ALIYUN_ACCESS_KEY_SECRET }} --region cn-hangzhou
